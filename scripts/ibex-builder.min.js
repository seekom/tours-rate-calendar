$(function(){$('#calStartDate').datepicker({dateFormat:'yy-mm-dd',onSelect:function(dateText,inst){ibexBuilder.GetData(dateText);},showOn:'both',buttonImage:'dashboard-icon.gif',buttonImageOnly:true});ibexBuilder.GetData(ibexBuilder.StartOffsetDays);});ibexBuilder.Initialise=function()
{this.dow=new Array('Sun','Mon','Tue','Wed','Thu','Fri','Sat');this.months=new Array('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec');this.htmlTable='<table class="calendarTable" border="1" cellpadding="3" cellspacing="0" bordercolor="#FFFFFF" width="100%">';this.htmlHdrRow='<tr class="header">';this.htmlHdrColName='<td width="{ColWidths.Name}">Tour Type/Package<br><i>Rate Name</i></td>';this.htmlHdrColGuests='<td width="{ColWidths.Guests}" class="center">Max<br>Group</td>';this.htmlHdrColMinStay='<td width="{ColWidths.MinStay}" class="center">Min&nbsp;Stay<br>(nights)</td>';this.htmlHdrColDay='<td width="{ColWidths.Days}" class="center">{DateDow}<br>{DateText}</td>';this.htmlRow='<tr class="{OddEven}row">';this.htmlColName='<td class="roomrate" rowspan="{MinStaysCount}">{RoomDetails}<br><i>{RateDetails}</i></td>';this.htmlColGuests='<td class="maxguests" rowspan="{MinStaysCount}" align="center">{RateMaxPax}</td>';this.htmlColMinStay='<td class="minstay" align="center">{MinStay}</td>';this.htmlColDaySold='<td class="sold">-</td>';this.htmlColDayAvail='<td class="{AvailClass}_{OddEven}">{DayDetails}</td>';this.htmlRoomDetails='<a class="addToolTip" title="<div id=\'ToolTipTextWrap\'>Tour</div>{RoomDesc}">{RoomName}</a>';this.htmlRateDetails='<a class="addToolTip" title="<div id=\'ToolTipTextWrap\'>Rate</div>{RateDesc}">{RateName}</a>';this.htmlDayDetails='<a onclick="ibexBuilder.GoToPage(\'{DateYmd}\', {MinStay}, {RoomId}, {RateId},\'{CustomUrl}\')"'+'class="addToolTip" title="<div id=\'ToolTipTextWrap\'>Click to book</div><p>{AvailabilityInfo}</p>">{RoomRate}</a>';document.getElementById('calendarPrev').innerHTML='&lt;&lt; Prev '+ibexBuilder.NoOfDays+' Days';document.getElementById('calendarNext').innerHTML='Next '+ibexBuilder.NoOfDays+' Days &gt;&gt;';}
ibexBuilder.OnError=function(error)
{document.getElementById("calendarBusy").style.display="none";alert(error);}
ibexBuilder.ShowBusy=function()
{document.getElementById("calendarBusy").style.display="inline";var calendarContent=document.getElementById('calendarContent');calendarContent.setAttribute('class','content-busy');}
ibexBuilder.PrevPeriod=function()
{this.GetData(-this.NoOfDays);}
ibexBuilder.NextPeriod=function()
{this.GetData(this.NoOfDays);}
ibexBuilder.GoToPage=function(stDate,minStay,roomId,rateId,customUrl)
{var endDate=new Date(this.DateFromString(stDate));endDate.setDate(endDate.getDate()+minStay);var sep,url,target=this.TargetWindow;if(customUrl==='')
{sep=this.TargetUrl.indexOf('?')<0?'?':'&';url=this.TargetUrl+sep+'op='+this.OperatorId+'&pid='+this.PropertyId+
(this.TargetRegUserId!=''?('&ru='+this.TargetRegUserId):'')+'&datein='+stDate+'&dateout='+this.DateToString(endDate)+'&room='+roomId+'&rate='+rateId;}
else
{sep=customUrl.indexOf('?')<0?'?':'&';url=customUrl+sep+'datein='+stDate+'&dateout='+this.DateToString(endDate);target='_blank';}
if(this.TargetSafariFix!=''){var redirectURL=encodeURIComponent(url);var url=this.TargetSafariFix+'?url='+redirectURL;}
var newWindow=window.open(url,target);try
{newWindow.focus();}
catch(e){}}
ibexBuilder.Build=function(data)
{if(this.htmlTable==null)this.Initialise();this.StartDate=data.StartDate;this.EndDate=data.EndDate;document.getElementById('calStartDate').value=this.DateToString(this.StartDate);var html=this.htmlTable+
this.htmlHdrRow;if(this.ShowTourName)html+=this.htmlHdrColName.replace("{ColWidths.Name}",this.ColWidths.Name)
if(this.ShowMaxGuest)html+=this.htmlHdrColGuests.replace("{ColWidths.Guests}",this.ColWidths.Guests);if(this.AllMinStays)html+=this.htmlHdrColMinStay.replace("{ColWidths.MinStay}",this.ColWidths.MinStay);var day=new Date(this.StartDate);for(var dayCt=0;dayCt<this.NoOfDays;dayCt++)
{var dateText='0'+day.getDate();dateText=dateText.substr(dateText.length-2)+' '+this.months[day.getMonth()];html+=this.htmlHdrColDay.replace("{ColWidths.Days}",this.ColWidths.Days).replace("{DateDow}",this.dow[day.getDay()]).replace("{DateText}",dateText);day.setDate(day.getDate()+1);}
var rowNo=0,oddEven=new Array('odd','even');for(var roomKey=0;roomKey<data.Rooms.length;roomKey++)
{var room=data.Rooms[roomKey];for(var rateKey=0;rateKey<room.Rates.length;rateKey++)
{var rate=room.Rates[rateKey],rowType=oddEven[rowNo++%2],roomRateRow=true;for(var minStayKey=0;minStayKey<rate.MinStays.length;minStayKey++)
{var minStay=rate.MinStays[minStayKey];if(this.AllMinStays&&this.HideUnavailMinStays){if(minStay.HasAvailability===false){continue;}}
html+='</tr>'+
this.htmlRow.replace("{OddEven}",rowType);if(roomRateRow)
{var roomDescTrunc=room.Desc.length>250?(room.Desc.substr(0,250)+' ...'):room.Desc;var rateDescTrunc=rate.Desc.length>250?(rate.Desc.substr(0,250)+' ...'):rate.Desc;var roomHtml=roomDescTrunc==''?room.Name:this.htmlRoomDetails.replace("{RoomDesc}",roomDescTrunc).replace("{RoomName}",room.Name);var rateHtml=rateDescTrunc==''?rate.Name:this.htmlRateDetails.replace("{RateDesc}",rateDescTrunc).replace("{RateName}",rate.Name);html+=this.htmlColName.replace("{MinStaysCount}",rate.MinStays.length).replace("{RoomDetails}",roomHtml).replace("{RateDetails}",rateHtml)+
this.htmlColGuests.replace("{MinStaysCount}",rate.MinStays.length).replace("{RateMaxPax}",rate.MaxPax);roomRateRow=false;}
if(this.AllMinStays)html+=this.htmlColMinStay.replace("{MinStay}",minStay.MinStay);day=new Date(data.StartDate);for(var dayCt=0;dayCt<this.NoOfDays;dayCt++)
{var dayInfo=minStay.GetDay(day);if(dayInfo.Status=='Unavailable')html+=this.htmlColDaySold;else
{var availClass=dayInfo.Status=='Instant Confirmation'?'available':'onreq';var availInfo=dayInfo.Available+' place'+(dayInfo.Available>1?'s':'')+' available<br>'+'Rate '+(rate.BasePax>1?('for '+rate.BasePax+' people'):'per person')+'<br>';var roomRate=data.CurrencySymbol+Math.round(parseInt(dayInfo.BaseRate));var dayDetails=this.htmlDayDetails.replace("{DateYmd}",this.DateToString(day)).replace("{MinStay}",dayInfo.MinStay);dayDetails=dayDetails.replace("{RoomId}",room.Id).replace("{RateId}",rate.Id);dayDetails=dayDetails.replace("{CustomUrl}",data.CustomUrl);dayDetails=dayDetails.replace("{AvailabilityInfo}",availInfo).replace("{RoomRate}",roomRate);html+=this.htmlColDayAvail.replace("{AvailClass}",availClass).replace("{OddEven}",rowType).replace("{DayDetails}",dayDetails);}
day.setDate(day.getDate()+1);}}}}
html+='</tr></table>';var calendarContent=document.getElementById('calendarContent');var colorScheme=(typeof this.CustomColorScheme==='undefined'||this.CustomColorScheme===''?'navy':this.CustomColorScheme);calendarContent.innerHTML=html+'<div class="loading-calendar"></div>';calendarContent.setAttribute('class',colorScheme.toLowerCase());addwarning();document.getElementById("calendarBusy").style.display="none";iframeResizePipe();}
function iframeResizePipe()
{var height=document.body.scrollHeight;var pipe=document.getElementById('ibex-frame');pipe.src=ibexBuilder.ibexHelper+'?height='+height+'&cacheb='+Math.random();}